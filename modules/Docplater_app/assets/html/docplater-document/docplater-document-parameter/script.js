// Generated by LiveScript 1.4.0
/**
 * @package   Docplater app
 * @category  modules
 * @author    Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @copyright Copyright (c) 2016, Nazar Mokrynskyi
 * @license   AGPL-3.0, see license.txt
 */
(function(){
  var Event;
  Event = cs.Event;
  Polymer({
    is: 'docplater-document-parameter',
    behaviors: [cs.Docplater.behaviors.document, cs.Docplater.behaviors.document_clause],
    hostAttributes: {
      contenteditable: 'false',
      tabindex: 0
    },
    properties: {
      highlight: {
        reflectToAttribute: true,
        type: Boolean
      },
      name: String,
      parameter: Object,
      preview: false,
      value: String
    },
    listeners: {
      'focus': '_focus_in',
      'blur': '_focus_out'
    },
    created: function(){
      this._highlighting = this._highlighting.bind(this);
      this._set_preview = this._set_preview.bind(this);
      this._track_parameter_effective_value = this._track_parameter_effective_value.bind(this);
      Event.on('docplater/parameter/highlight', this._highlighting);
      Event.on('docplater/document/preview', this._set_preview);
    },
    attached: function(){
      this.name = this.textContent.trim();
      if (this.clause) {
        this.parameter = this.document.data.clauses[this.clause.hash].parameters[this.name];
      } else {
        this.parameter = this.document.data.parameters[this.name];
      }
      this._update_display_value();
      this.parameter.once(this._track_parameter_effective_value);
    },
    _track_parameter_effective_value: function(){
      var parameter, this$ = this;
      parameter = this.parameter;
      parameter.on(function(){
        if (parameter !== this$.parameter) {
          this$._track_parameter_effective_value();
          parameter.off(this$._track_parameter_effective_value);
        }
        this$._update_display_value();
      }, ['effective_value']);
    },
    _update_display_value: function(parameter){
      this.value = this.parameter.effective_value || "@" + this.name;
    },
    _focus_in: function(){
      Event.fire('docplater/parameter/highlight', {
        absolute_id: this.parameter.absolute_id
      });
    },
    _focus_out: function(){
      Event.fire('docplater/parameter/highlight');
    },
    _highlighting: function(arg$){
      var absolute_id;
      if (arg$ != null) {
        absolute_id = arg$.absolute_id;
      }
      this.highlight = absolute_id === this.parameter.absolute_id;
    },
    _set_preview: function(arg$){
      this.preview = arg$.preview;
    }
  });
}).call(this);
