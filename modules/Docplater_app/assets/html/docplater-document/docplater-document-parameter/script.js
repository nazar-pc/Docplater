// Generated by LiveScript 1.4.0
/**
 * @package   Docplater app
 * @category  modules
 * @author    Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @copyright Copyright (c) 2016, Nazar Mokrynskyi
 * @license   AGPL-3.0, see license.txt
 */
(function(){
  var Event, Parameter;
  Event = cs.Event;
  Parameter = cs.Docplater.Parameter;
  Polymer({
    is: 'docplater-document-parameter',
    behaviors: [cs.Docplater.behaviors.document, cs.Docplater.behaviors.document_clause],
    hostAttributes: {
      contenteditable: 'false',
      tabindex: 0
    },
    properties: {
      absolute_id: String,
      highlight: {
        reflectToAttribute: true,
        type: Boolean
      },
      name: String,
      preview: false,
      value: String
    },
    listeners: {
      'focus': '_focus_in',
      'blur': '_focus_out'
    },
    created: function(){
      this._highlighting = this._highlighting.bind(this);
      this._set_preview = this._set_preview.bind(this);
      this._update = this._update.bind(this);
      Event.on('dockplater/parameter/highlight', this._highlighting);
      Event.on('dockplater/document/preview', this._set_preview);
    },
    attached: function(){
      this.name = this.textContent.trim();
      this.document.when_ready.then(this._update);
    },
    _update: function(){
      var parameter, name;
      this.absolute_id = this.document.hash + '/' + this.name;
      parameter = this.document.get_parameter(this.name);
      if (this.clause) {
        parameter = this.clause.get_parameter(this.name);
        if (parameter && parameter.value.indexOf('@') === 0) {
          name = parameter.value && parameter.value.substring(1);
          this.absolute_id = this.document.hash + '/' + name;
          parameter = this.document.get_parameter(name);
        } else {
          this.absolute_id = this.document.hash + '/' + this.clause.hash + '/' + name;
        }
      }
      this.value = parameter.value || parameter.default_value;
    },
    _focus_in: function(){
      Event.fire('dockplater/parameter/highlight', {
        absolute_id: this.absolute_id
      });
    },
    _focus_out: function(){
      Event.fire('dockplater/parameter/highlight');
    },
    _highlighting: function(arg$){
      var absolute_id;
      if (arg$ != null) {
        absolute_id = arg$.absolute_id;
      }
      this.highlight = absolute_id === this.absolute_id;
    },
    _set_preview: function(arg$){
      this.preview = arg$.preview;
    }
  });
}).call(this);
